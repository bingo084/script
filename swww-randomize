#!/bin/bash

# 指定图片文件夹的路径
image_folder="$1"

# 指定壁纸切换的间隔时间（秒）
interval="$2"

# 检查参数是否合法
if [[ $# -ne 2 ]]; then
	echo "Usage: $0 <image_folder> <interval_seconds>"
	exit 1
fi
if [[ ! -d "$image_folder" ]]; then
	echo "The specified image folder '$image_folder' does not exist"
	exit 1
fi

# 图片切换参数
export SWWW_TRANSITION=any
export SWWW_TRANSITION_STEP=90
export SWWW_TRANSITION_FPS=60

# 主循环，不断随机选择图片并设置为壁纸
while true; do
	if ! swww query >/dev/null; then
		exit 1
	fi

	# 使用 find 命令列出文件夹中的所有图片文件
	image_files=($(find "$image_folder" -type f -iregex '.*\.\(jpg\|jpeg\|png\|gif\|bmp\)$'))

	# 检查是否存在图片文件
	if [[ ${#image_files[@]} -eq 0 ]]; then
		echo "No image files found in '$image_folder'"
		exit 1
	fi

	# 随机选择一张图片
	random_index=$((RANDOM % ${#image_files[@]}))
	selected_image="${image_files[random_index]}"

	# 使用 swww img 命令设置图片为壁纸
	swww img "$selected_image"

	# 等待指定的间隔时间
	sleep "$interval"
done
